<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G153DWZ7W5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-G153DWZ7W5');
    </script>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <title>
LLM Tool Calling | 叶某人的碎碎念    </title>
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/pygment.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/normalize/6.0.0/normalize.min.css" />
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css" />
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7674955363445536"
     crossorigin="anonymous"></script>
</head>

<body>
<div class="body_container">
    <div id="header">
        <div class="site-name">
            <a id="logo" href="/."> 叶某人的碎碎念 </a>
            <p class="description"> Believe in Mathematics </p>
        </div>
        <div id="nav-menu">
            <a href="/."><i class="fa fa-home"> Home</i></a>
            <a href="/movies/"><i class="fa fa-film"> Movies</i></a>
            <a href="/archives.html"><i class="fa fa-archive"> Archive</i></a>
        </div>
    </div>
    <div id="layout" class="pure-g">
        <div class="pure-u-1 pure-u-lg-3-4"><div class="content_container">
<div class="post">
    <h1 class="post-title">LLM Tool Calling</h1>
    <div class="post-meta">Dec 25, 2025
    <span> | </span> <span>Machine Learning</span>
    </div>
    <a data-disqus-identifier="20251225-LLM-tool-calling/" href="/20251225-LLM-tool-calling/#disqus_thread" class="disqus-comment-count"></a>
    <div class="post-content">
        <p>I recently tried to update my <a href="https://wormtooth.com/movies/">movie page</a> but failed - the package <a href="https://github.com/cinemagoer/cinemagoer">cinemagoer</a> could not fetch all the needed information from <a href="https://www.imdb.com">IMDb</a>. I decided to try LLM instead of a rule based engine to extract movie information. It works and works pretty well with <code>tool calling</code> for a structured output. I am going to document my understanding of tool calling, what it is for, and how to use it for structured output.</p>
<p>Quick note: Codes are tailored to <a href="https://huggingface.co/Qwen/Qwen3-4B-Instruct-2507">Qwen/Qwen3-4B-Instruct-2507</a> and <a href="https://github.com/ml-explore/mlx-lm">mlx_lm</a>. They might need adjustment with other models and frameworks.</p>
<!--more-->

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlx_lm</span> <span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">generate</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;Qwen/Qwen3-4B-Instruct-2507&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_completion</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete a prompt.&quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">apply_chat_template</span><span class="p">(</span>
        <span class="n">messages</span><span class="p">,</span> <span class="n">add_generation_prompt</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>


<pre>/Users/rye/miniconda3/envs/mlx/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
Fetching 10 files: 100%|██████████| 10/10 [00:00<00:00, 98227.26it/s]
</pre>

<div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;What date is it today?&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_completion</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>


<pre>I can't access real-time information, including today
</pre>

<h1>Tool Calling</h1>
<p>A stand-alone LLM cannot answer simple questions such as "What date is it today?". Once the training is done, the internal knowledge of the LLM is fixed and it cannot reliably answer questions beyond its internal knowledge. One common way to increase its knowledge is to include needed context in prompts. Another one is to add tool calling capability to the LLM during the training process so that it can interact with external world to get the needed context on its own judgment.</p>
<div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Explain tool calling in one paragraph.&quot;</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">get_completion</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1024</span><span class="p">))</span>
</pre></div>


<pre>('Tool calling is a capability in artificial intelligence, particularly in '
 'large language models (LLMs), that allows the model to invoke external '
 'functions or tools—such as APIs, databases, or software programs—to perform '
 'specific tasks that the model cannot execute directly. Instead of generating '
 'a complete response based solely on its internal knowledge, the model '
 'identifies a relevant action (e.g., searching a database or retrieving '
 'weather data) and "calls" an appropriate tool to obtain the required '
 'information. The tool executes the request, returns the result, and the '
 'model uses that output to complete its response, enabling more accurate, '
 'up-to-date, and contextually relevant answers. This mechanism enhances the '
 "model's ability to interact with the real world and perform complex, "
 'multi-step reasoning.')
</pre>

<div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Explain how LLM obtains tool calling capability in one paragraph.&quot;</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">get_completion</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1024</span><span class="p">))</span>
</pre></div>


<pre>('Large Language Models (LLMs) obtain tool calling capability through a '
 'combination of architectural modifications and training techniques that '
 'enable them to recognize, interpret, and execute external tools or '
 'functions. This is typically achieved by integrating a "tool-use" module '
 'into the model’s architecture, where the model learns to generate structured '
 'prompts that specify which tool to invoke and what input parameters to pass. '
 'During training, the LLM is exposed to examples of human instructions paired '
 'with tool calls and corresponding outputs, allowing it to learn the mapping '
 'between natural language queries and appropriate function invocations. '
 'Additionally, reinforcement learning from human feedback (RLHF) or direct '
 'preference optimization can refine the model’s ability to select the most '
 'relevant tools in context. In some cases, the model is trained with a '
 '"tool-aware" instruction-tuning process, where it learns to detect '
 'tool-relevant phrases and generate function calls in a safe, structured '
 'format. This enables the LLM to act as an intelligent agent capable of '
 'performing complex tasks by leveraging external systems like APIs, '
 'databases, or web search.')
</pre>

<p>Not all LLMs come with tool calling capability. We should confirm before using the LLM for tool calling. We can read the technical reports, or simply go through its model card. For example, it mentions "tool usage" in the model card of <a href="https://huggingface.co/Qwen/Qwen3-4B-Instruct-2507">Qwen/Qwen3-4B-Instruct-2507</a>. We can also find its performance on relevant benchmarks - <a href="https://gorilla.cs.berkeley.edu/blogs/13_bfcl_v3_multi_turn.html">BFCL v3</a>, <a href="https://arxiv.org/abs/2406.12045">Tau 1</a>, and <a href="https://arxiv.org/abs/2506.07982">Tau 2</a>. These are strong evidence that the model has the tool calling capability.</p>
<p>The next step is to get some understanding of how the LLM was trained for the tool calling. Different LLM providers can structure the input and output differntly during the training process. We should align the data layout as much as we can to the training process to maximize LLM's performance. We can take a look at the chat template for some hint. Below is relevant part of the output from <code>tokenizer.get_chat_template()</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span>- <span class="k">if</span> <span class="nv">tools</span> <span class="cp">%}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="s1">&#39;&lt;|im_start|&gt;system\n&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">if</span> <span class="nv">messages</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="nv">.role</span> <span class="o">==</span> <span class="s1">&#39;system&#39;</span> <span class="cp">%}</span>
<span class="w">        </span><span class="cp">{{</span><span class="o">-</span> <span class="nv">messages</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="nv">.content</span> <span class="o">+</span> <span class="s1">&#39;\n\n&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="s2">&quot;# Tools\n\nYou may call one or more functions to assist with the user query.\n\nYou are provided with function signatures within &lt;tools&gt;&lt;/tools&gt; XML tags:\n&lt;tools&gt;&quot;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">for</span> <span class="nv">tool</span> <span class="k">in</span> <span class="nv">tools</span> <span class="cp">%}</span>
<span class="w">        </span><span class="cp">{{</span><span class="o">-</span> <span class="s2">&quot;\n&quot;</span> <span class="cp">}}</span>
<span class="w">        </span><span class="cp">{{</span><span class="o">-</span> <span class="nv">tool</span> <span class="o">|</span> <span class="nf">tojson</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">endfor</span> <span class="cp">%}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="s2">&quot;\n&lt;/tools&gt;\n\nFor each function call, return a json object with function name and arguments within &lt;tool_call&gt;&lt;/tool_call&gt; XML tags:\n&lt;tool_call&gt;\n{\&quot;name\&quot;: &lt;function-name&gt;, \&quot;arguments\&quot;: &lt;args-json-object&gt;}\n&lt;/tool_call&gt;&lt;|im_end|&gt;\n&quot;</span> <span class="cp">}}</span>
<span class="cp">{%</span>- <span class="k">else</span> <span class="cp">%}</span>
</pre></div>


<p>From the Qwen3's chat template, we can provide <code>tools</code> to it via <code>tokenizer.apply_chat_template</code>. The tools will be inserted in the system message as a "# Tools" section. The input/output are orgainized in XML tags. Each tool will be formatted to a JSON string by <code>tojson</code>. In this <a href="https://qwen.readthedocs.io/en/latest/framework/function_call.html">article</a>, we can also find the specs to describe a tool. Here is a classic <code>get_current_temperature</code> example:</p>
<div class="highlight"><pre><span></span><span class="n">temperature_tool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;get_current_temperature&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Get current temperature at a location.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The location to get the temperature for, in the format </span><span class="se">\&quot;</span><span class="s2">City, State, Country</span><span class="se">\&quot;</span><span class="s2">.&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;enum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;celsius&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;fahrenheit&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s2">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The unit to return the temperature in. Defaults to </span><span class="se">\&quot;</span><span class="s2">celsius</span><span class="se">\&quot;</span><span class="s2">.&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;location&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span>
</pre></div>


<p>We can pass in <code>tools=[temperature_tool]</code> in <code>tokenizer.apply_chat_template</code> to make the tools available to the model. One issue is that it is quite some work to describe a tool using the format above manually. Luckily, since this tool format is so commonly used that the tokenizer implementation from transformers can accept functions with appropriate docstrings as tools. It converts the functions to the format above with information fetched from docstrings. Let's provide a <code>today</code> tool to the model so that it can answer the date of today.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">today</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get today&#39;s date in YYYY-MM-DD.&quot;&quot;&quot;</span>
    <span class="n">today_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">today_date</span><span class="si">:</span><span class="s2">%Y-%m-%d</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="nb">print</span><span class="p">(</span><span class="n">today</span><span class="p">())</span>
</pre></div>


<pre>2025-12-25
</pre>

<div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;What date is it today?&quot;</span>
<span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)]</span>
<span class="n">formatted_prompt</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">apply_chat_template</span><span class="p">(</span>
    <span class="n">messages</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">today</span><span class="p">],</span>
    <span class="n">add_generation_prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tokenize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formatted_prompt</span><span class="p">)</span>
</pre></div>


<pre><|im_start|>system
# Tools

You may call one or more functions to assist with the user query.

You are provided with function signatures within <tools></tools> XML tags:
<tools>
{"type": "function", "function": {"name": "today", "description": "Get today's date in YYYY-MM-DD.", "parameters": {"type": "object", "properties": {}}}}
</tools>

For each function call, return a json object with function name and arguments within <tool_call></tool_call> XML tags:
<tool_call>
{"name": <function-name>, "arguments": <args-json-object>}
</tool_call><|im_end|>
<|im_start|>user
What date is it today?<|im_end|>
<|im_start|>assistant

</pre>

<p>Please pay attention to <code>tools=[today]</code> in <code>tokenizer.apply_chat_template</code> and how it is presented as a tool in the system message. With this prompt, the model now has the tool needed to answer the "date" question.</p>
<div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">formatted_prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">128</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>


<pre><tool_call>
{"name": "today", "arguments": {}}
</tool_call>
</pre>

<p>Instead of saying it cannot answer the question, it responds the need to call a function <code>today</code> to get the information needed for the question. Looking at the chat template again, we can learn how to pass the response of the function back to the model.</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span>- <span class="k">elif</span> <span class="nv">message.role</span> <span class="o">==</span> <span class="s2">&quot;tool&quot;</span> <span class="cp">%}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">if</span> <span class="nb">loop</span><span class="nv">.first</span> <span class="k">or</span> <span class="o">(</span><span class="nv">messages</span><span class="o">[</span><span class="nb">loop</span><span class="nv">.index0</span> <span class="o">-</span> <span class="m">1</span><span class="o">]</span><span class="nv">.role</span> <span class="o">!=</span> <span class="s2">&quot;tool&quot;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="w">        </span><span class="cp">{{</span><span class="o">-</span> <span class="s1">&#39;&lt;|im_start|&gt;user&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="s1">&#39;\n&lt;tool_response&gt;\n&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="nv">content</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{{</span><span class="o">-</span> <span class="s1">&#39;\n&lt;/tool_response&gt;&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">if</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="k">or</span> <span class="o">(</span><span class="nv">messages</span><span class="o">[</span><span class="nb">loop</span><span class="nv">.index0</span> <span class="o">+</span> <span class="m">1</span><span class="o">]</span><span class="nv">.role</span> <span class="o">!=</span> <span class="s2">&quot;tool&quot;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="w">        </span><span class="cp">{{</span><span class="o">-</span> <span class="s1">&#39;&lt;|im_end|&gt;\n&#39;</span> <span class="cp">}}</span>
<span class="w">    </span><span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>


<p>We will pass back the response with <code>rool="tool"</code>, and <code>content</code> the return of the function. We can go sophisticated on the tool registry and executor. But for simplicity, I assume the tools are defined in <code>globals()</code>.</p>
<div class="highlight"><pre><span></span><span class="n">tool_call_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s2">&quot;&lt;tool_call&gt;(.*?)&lt;/tool_call&gt;|&lt;tool_call&gt;(.*)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_tool_calls</span><span class="p">(</span><span class="n">resp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse tool calls in LLM response.&quot;&quot;&quot;</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">tool_call_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">tools</span>


<span class="k">def</span> <span class="nf">execute_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a tool.&quot;&quot;&quot;</span>
    <span class="n">func_name</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">func_args</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span>
    <span class="n">func</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">func_name</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">func_args</span><span class="p">)</span>
    <span class="n">tool_message</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;tool&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tool_message</span>


<span class="n">tool_calls</span> <span class="o">=</span> <span class="n">parse_tool_calls</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool calls:&quot;</span><span class="p">,</span> <span class="n">tool_calls</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tool_calls</span><span class="p">:</span>
    <span class="n">tool_resp</span> <span class="o">=</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool call response:&quot;</span><span class="p">,</span> <span class="n">tool_resp</span><span class="p">)</span>
</pre></div>


<pre>Tool calls: [{'name': 'today', 'arguments': {}}]
Tool call response: {'role': 'tool', 'content': '2025-12-25'}
</pre>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_completion_with_tools</span><span class="p">(</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tools</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eval_tools</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete a prompt with tools.&quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)]</span>
    <span class="c1"># assistant</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">apply_chat_template</span><span class="p">(</span>
        <span class="n">messages</span><span class="p">,</span> <span class="n">add_generation_prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
    <span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span>
    <span class="p">)</span>
    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">resp</span><span class="p">))</span>

    <span class="c1"># tool use</span>
    <span class="k">while</span> <span class="n">eval_tools</span><span class="p">:</span>
        <span class="n">tool_calls</span> <span class="o">=</span> <span class="n">parse_tool_calls</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="c1"># break the loop if no tool calls</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_calls</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># execute tools</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tool_calls</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">execute_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">))</span>

        <span class="c1"># run completion again with tool responses</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">apply_chat_template</span><span class="p">(</span>
            <span class="n">messages</span><span class="p">,</span> <span class="n">add_generation_prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="p">,</span>
            <span class="n">prompt</span><span class="p">,</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span>
        <span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">resp</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">messages</span>
</pre></div>


<p>Let's ask the model again the date of today with tools provided.</p>
<div class="highlight"><pre><span></span><span class="n">messages</span> <span class="o">=</span> <span class="n">get_completion_with_tools</span><span class="p">(</span>
    <span class="s2">&quot;What date is it today?&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">today</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
</pre></div>


<pre>Today's date is December 25, 2025.
</pre>

<p>We can go further to ask for the weekday of today, with another tool passed in.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_weekday</span><span class="p">(</span><span class="n">date_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the weekday of a given date.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_str: the date string in the format of YYYY-MM-DD.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date</span><span class="si">:</span><span class="s2">%A</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">messages</span> <span class="o">=</span> <span class="n">get_completion_with_tools</span><span class="p">(</span>
    <span class="s2">&quot;What weekday is it today?&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">today</span><span class="p">,</span> <span class="n">get_weekday</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
</pre></div>


<pre>Today is Thursday, December 25, 2025.
</pre>

<div class="highlight"><pre><span></span><span class="c1"># take a look into the seqence of tool calls from the messages</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</pre></div>


<pre>[{'content': 'What weekday is it today?', 'role': 'user'},
 {'content': '<tool_call>\n{"name": "today", "arguments": {}}\n</tool_call>',
  'role': 'assistant'},
 {'content': '2025-12-25', 'role': 'tool'},
 {'content': '<tool_call>\n'
             '{"name": "get_weekday", "arguments": {"date_str": '
             '"2025-12-25"}}\n'
             '</tool_call>',
  'role': 'assistant'},
 {'content': 'Thursday', 'role': 'tool'},
 {'content': 'Today is Thursday, December 25, 2025.', 'role': 'assistant'}]
</pre>

<p>The model is smart enough that it invokes <code>today</code> to get the date of today and then uses <code>get_weekday</code> with the right argument to get the weekday.</p>
<h1>Structured Output</h1>
<p>One clever use of tool calling is to get structured output instead of plain text output. The main idea is in the <code>arguments</code> field in the tool calls, which is in JSON format. Let's come back the original quest - extract movie information from IMDb page. We will see the normal output first.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span>
<span class="p">}</span>
<span class="c1"># Avata: Fire and Ash</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.imdb.com/title/tt1757678/&quot;</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">page</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

<span class="c1"># get the text from the page</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">page_text</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">page_text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>


<pre>Avatar: Fire and Ash (2025) - IMDb 
</pre>

<div class="highlight"><pre><span></span><span class="n">movie_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Extract movie information from the given text.</span><span class="se">\n\n</span><span class="s2"># Text</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">get_completion</span><span class="p">(</span><span class="n">movie_prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>


<pre>Here is the extracted movie information from the provided text:

---

**Movie Title:** *Avatar: Fire and Ash*  
**Release Year:** 2025  
**Release Date (United States):** December 19, 2025  
**Genre:** Action, Adventure, Epic, Fantasy, Sci-Fi  
**Rating:** PG-13  
**Runtime:** 3 hours 17 minutes (197 minutes)  
**IMDb Rating:** 7.5/10 (based on 46K user ratings)  
**Director:** James Cameron  
**Writers:** James Cameron,
</pre>

<p>The model is pretty good at extracting the relevant movie information. But one problem is that the output is not structured that we still need to parse it into fields before we can save it to a database. Another problem is that the model might not foucs on the information we want. To solve this issue, we can define a tool to specify the structure and information we need to extract.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Movie</span><span class="p">(</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rating_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">rating_count</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">genre</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">publish_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">stars</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">director</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">writer</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracted information for a movie.</span>

<span class="sd">    Args:</span>
<span class="sd">        title: the title of the movie.</span>
<span class="sd">        rating_value: the IMDb rating of the movie on the scale of 0~10.</span>
<span class="sd">        rating_count: the number of people for the IMDb rating.</span>
<span class="sd">        desc: the plot of the movie.</span>
<span class="sd">        genre: the genres of the movie, separated by comma if more than one.</span>
<span class="sd">        duration: the duration of the movie.</span>
<span class="sd">        publish_date: the release date of the movie.</span>
<span class="sd">        stars: the stars of the movie, separated by comma.</span>
<span class="sd">        director: the director of the movie, separated by comma if more than one.</span>
<span class="sd">        writer: the writer of the movie, separated by comma if more than one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>


<p>For structured output, we don't really need a function (you can if you want), but just a way to specify the fields we need and the descriptions. We make use of the docstrings to define the structure and pass it to Qwen3 as a tool.</p>
<div class="highlight"><pre><span></span><span class="n">messages</span> <span class="o">=</span> <span class="n">get_completion_with_tools</span><span class="p">(</span>
    <span class="n">movie_prompt</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">Movie</span><span class="p">],</span>
    <span class="n">eval_tools</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># we don&#39;t need to eval the tools</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="c1"># make it large enough to hold the output</span>
<span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>


<pre>('<tool_call>\n'
 '{"name": "Movie", "arguments": {"title": "Avatar: Fire and Ash", '
 '"rating_value": 7.5, "rating_count": "46K", "desc": "Jake and Neytiri\'s '
 "family grapples with grief, encountering a new, aggressive Na'vi tribe, the "
 'Ash People, who are led by the fiery Varang, as the conflict on Pandora '
 'escalates and a new moral focus emerges.", "genre": "Action Epic, Adventure '
 'Epic, Epic, Fantasy Epic, Sci-Fi Epic", "duration": "3h 17m", '
 '"publish_date": "December 19, 2025", "stars": "Sam Worthington, Zoe Saldaña, '
 'Sigourney Weaver, Stephen Lang, Oona Chaplin, Kate Winslet, Cliff Curtis, '
 'CCH Pounder, Edie Falco, Brendan Cowell, Jemaine Clement, David Thewlis, '
 'Britain Dalton, Jack Champion", "director": "James Cameron", "writer": '
 '"James Cameron, Rick Jaffa, Amanda Silver"}}\n'
 '</tool_call>')
</pre>

<div class="highlight"><pre><span></span><span class="n">movie</span> <span class="o">=</span> <span class="n">parse_tool_calls</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
</pre></div>


<pre>{'desc': "Jake and Neytiri's family grapples with grief, encountering a new, "
         "aggressive Na'vi tribe, the Ash People, who are led by the fiery "
         'Varang, as the conflict on Pandora escalates and a new moral focus '
         'emerges.',
 'director': 'James Cameron',
 'duration': '3h 17m',
 'genre': 'Action Epic, Adventure Epic, Epic, Fantasy Epic, Sci-Fi Epic',
 'publish_date': 'December 19, 2025',
 'rating_count': '46K',
 'rating_value': 7.5,
 'stars': 'Sam Worthington, Zoe Saldaña, Sigourney Weaver, Stephen Lang, Oona '
          'Chaplin, Kate Winslet, Cliff Curtis, CCH Pounder, Edie Falco, '
          'Brendan Cowell, Jemaine Clement, David Thewlis, Britain Dalton, '
          'Jack Champion',
 'title': 'Avatar: Fire and Ash',
 'writer': 'James Cameron, Rick Jaffa, Amanda Silver'}
</pre>

<p>Voilà, we get all the movie information we want in a dictionary <code>movie</code>!</p>
<p>Final words: Some may feel weird that we pass in a function for extraction instead of an object. That is the limitation of Qwen3 models. In its documentation for tool calling <a href="https://qwen.readthedocs.io/en/latest/framework/function_call.html">here</a>, it explicitly calls out that <code>currently only "function" is valid</code> for the tool type. If <code>object</code> type is also supported, we can define <code>Movie</code> as a Pydantic class and then pass in the model json schema as the tool. Though it is not officially supported, you can still try it as an exercise :)</p>

        <div class="tags">
        <a href="/tag/llm">LLM</a>
        <a href="/tag/genai">GenAI</a>
        </div>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7674955363445536"
     crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
         style="display:block; text-align:center;"
         data-ad-layout="in-article"
         data-ad-format="fluid"
         data-ad-client="ca-pub-7674955363445536"
         data-ad-slot="4714691501"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>


<div id="disqus_thread">
  <div class="btn_click_load">
    <button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button>
  </div>
  <script>
    var disqus_shortname = 'wormtooth';
    var disqus_identifier = '20251225-LLM-tool-calling/';
    var disqus_title = 'LLM Tool Calling';
    var disqus_url = 'https://wormtooth.com/20251225-LLM-tool-calling/';
    $('.btn_click_load').click(function() {
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || 
          document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      $('.btn_click_load').css('display','none');
    });

    $.ajax({
      url: 'https://disqus.com/favicon.ico',
      timeout: 3000,
      type: 'GET',
      success: (function() {
        var dsq = document.createElement('script'); 
        dsq.type = 'text/javascript'; 
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || 
          document.getElementsByTagName('body')[0]).appendChild(dsq);
        $('.btn_click_load').css('display','none');
      })(),
      error: function() {
        $('.btn_click_load').css('display','block');
        }
      });
  </script>
  <script id="dsq-count-scr" src="//wormtooth.disqus.com/count.js" async></script>
</div>
    </div>
</div>
        </div></div>
        <div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar">
<div class="widget">
    <form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form">
        <input type="text" name="q" maxlength="20" placeholder="Search"/>
        <input type="hidden" name="sitesearch" value="https://wormtooth.com"/>
    </form>
</div><div class="widget">
    <div class="widget-title"><i class="fa fa-heart-o"> 年轻的心只有一面</i></div>
    <img src="/images/mobius_heart.png" class="nofancybox" />
</div><div class="widget">
    <div class="widget-title"><i class="fa fa-paper-plane-o"> 心情随笔</i></div>
    <p>未来会来～</p>
    <span class="qed"><a href="/scribble">View All</a></span>
</div><div class="widget">
    <div class="widget-title">
        <i class="fa fa-folder-o"> Categories</i>
    </div>
    <ul class="category-list">
        <li class="category-list-item"><a class="category-list-link" href="/category/life/">Life</a></li>
        <li class="category-list-item"><a class="category-list-link" href="/category/machine-learning/">Machine Learning</a></li>
        <li class="category-list-item"><a class="category-list-link" href="/category/mathematics/">Mathematics</a></li>
        <li class="category-list-item"><a class="category-list-link" href="/category/notes/">Notes</a></li>
        <li class="category-list-item"><a class="category-list-link" href="/category/programming/">Programming</a></li>
    </ul>
</div><div class="widget">
    <div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div>
    <ul></ul>
    <a href="https://yongjiasong.com/" title="JOY DOMAIN" target="_blank">JOY DOMAIN</a>
</div>
<div class="widget">
    <div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div>
    <script type="text/javascript" src="//wormtooth.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=1&avatar_size=32&excerpt_length=20&hide_mods=1"></script>
</div>
        </div></div>
        <div class="pure-u-1 pure-u-lg-3-4">
<div id="footer">Copyright © 2025 <a href="/." rel="nofollow">叶某人的碎碎念.</a> <a rel="nofollow" target="_blank" href="https://getpelican.com/">Pelican</a> &amp; <a rel="nofollow", target="_blank", href="https://github.com/wormtooth/maupassant-pelican">maupassant</a>.</div>        </div>
    </div>
</div>
<a id="rocket" href="#top" class="show"></a>
<script type="text/javascript" src="/theme/js/totop.js" async></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js" async></script>
<script type="text/javascript" src="/theme/js/fancybox.js" async></script>
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />

<script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$', '$$'], ["\\[", "\\]"] ],
      processEscapes: true
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      },
      Macros: {
        N: "\\mathbb{N}",
        Z: "\\mathbb{Z}",
        Q: "\\mathbb{Q}",
        R: "\\mathbb{R}",
        C: "\\mathbb{C}"
      }
    },
    'HTML-CSS': {
      imageFont: null
    }
  });
</script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.1.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>